性能（查询）

> 重点、难点 - 数据结构与算法

一、索引

1、概念

- 索引（Index）是帮助MYSQL高效获取数据的数据结构
- 索引是数据结构。（索引文件）
  - 排好序的快速查找数据结构（树）
- 在添加（删除、修改）数据时，MySQL需要消耗资源维护索引文件
  - 因此，记录数不多的表不建议创建索引
  - 不要删除数据，业务上一定要删，则通过修改状态实现
- 索引：在某张表中，以一个字段或多个字段的组合进数据表中的数据进行重组（BTree数据结构），提高查询速度。



2、索引数据结构

1）二叉搜索树

2）红黑树

3）B Trees

4）B+ Trees

5）Hash索引



3、分类



4、索引操作

1）导入MySQL示例数据库

第一：下载、解压



第二：打开命令行，进入示例数据库根目录



第三：导入数据库

```shell
mysql < employees.sql -u root -p
```



第四：查看

```mysql
# 注意：在MySQL中，必须使用分号结束一个命令
# 终止命令：ctrl + c
# 查看历史命令：向上、向下方向键

# 查询当前MySQL中所有的数据库列表
show databases;

# 进入某个数据库
use 数据库名称;

# 查看当前数据库下所有的数据表 
show tables ;

# 查看数据表的结构
desc 表名称 ;

# 到此为止，就是增、删、改、查的操作 - 不方便操作 - 图形界面的工具
```



2）测试







二、性能分析

1.查看执行频次

2.开启慢查询日志

3.profile

4.执行计划 - explain



三、建立索引的建议

通过性能分析，找到某个表需要进行SQL优化，解决手段就是添加索引。

思考：给表的哪个字段或哪些字段创建索引呢？

- 主键自动建立唯一索引;

- 频繁作为查询条件的字段应该建立索引;

  ```mysql
  select * from users where username=? and password=?
  
  # 注意：增、删、改操作时可能会重新组织索引结构，因此
  # 1)在删除数据时，建议设置一个状态列，删除数据时，修改状态即可
  # 2)不要选择经常变量的字段作为索引
  ```

- 查询中与其他表关联的字段，即外键关系建立索引

-  要控制索引的数量

- 一般在开发中建议建立复合索引，如上面的帐号和密码

  ```mysql
  # 创建复合索引 - 建议，不建议分别创建索引
  create index idx_user_username_password
  	on user(username,password) ;
  
  # 创建单一索引 - username
  create index idx_user_username
  	on user(username) ;
  
  # 创建单一索引 - password
  create index idx_user_password
  	on user(password) ;
  ```

- 排序的字段

- 统计或者分组字段







四、索引使用原则